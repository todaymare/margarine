extern "https://github.com/todaymare/margarine-std" as std;
use std::*;
use std::io::read_file;

fn main() {
    var input = read_file("./examples/aoc2025/day4.txt");

    println(part1(input));
    println(part2(input));
}



fn part1(input: str): str {
    var lines = input.lines();
    var ranges = [];

    for line in lines {
        if line.is_empty() { break }

        var min, max = line.split_once("-")!;

        var min : int = min.parse()!;
        var max : int = max.parse()!;

        ranges.push(min..=max);
    }

    var fresh_ingredients = 0;
    for line in lines {
        var ingredient = line.parse()!;

        if ranges.iter().any(|r| r.contains(ingredient)) {
            fresh_ingredients += 1;
        }
    }
    
    fresh_ingredients.to_str()
}


fn part2(input: str): str {
    var lines = input.lines();
    var ranges : [Range] = [];

    for line in lines {
        if line.is_empty() { break }

        var min, max = line.split_once("-")!;

        var min : int = min.parse()!;
        var max : int = max.parse()!;
        var curr_range = min..=max;

        var consumed = false;
        loop {
            var changed = false;
            for i in 0..ranges.len() {
                var range = ranges[ranges.len() - i - 1];

                if range.contains(curr_range.min)
                && !range.contains(curr_range.max) {
                    curr_range.min = range.max;
                    changed = true;

                    print("moved min from ");
                    print(curr_range.min);
                    print(" to ");
                    println(range.max);


                }


                if range.contains(curr_range.max-1)
                && !range.contains(curr_range.min) {
                    curr_range.max = range.min;
                    changed = true;
                }


                if range.contains(curr_range.min)
                && range.contains(curr_range.max-1) {
                    consumed = true;
                    break;
                }
            }

            if !changed { break }
            if consumed { break }
        }


        if !consumed { ranges.push(curr_range) }
    }


    var count = 0;
    for range in ranges.iter() {
        print(range.min);
        print("..");
        println(range.max);

        count += range.len()
    }

    count.to_str()
}



impl Range {
    fn contains(self, num: int): bool {
        self.min <= num && num < self.max
    }


    fn len(self): int {
        self.max - self.min
    }
}


impl<T> Iter<T> {
    fn any(self, f: fn(T): bool): bool {
        for val in self {
            if f(val) { return true }
        }

        false
    }


    fn all(self, f: fn(T): bool): bool {
        !self.any(f)
    }
}
