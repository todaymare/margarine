use std::assert;

fn is_power_of_two(n: int): bool {
    if n <= 0 {
        false
    } else {
        if n == 1 {
            true
        } else {
            if n % 2 == 0 {
                is_power_of_two(n / 2)
            } else {
                false
            }
        }
    }
}

fn is_perfect_square(n: int): bool {
    if n < 0 {
        false
    } else {
        var i = 0;
        var found = false;
        while i * i <= n {
            if i * i == n {
                found = true;
                break;
            }
            i += 1;
        }
        found
    }
}

fn fib_iter(n: int, a: int, b: int): int {
    if n == 0 {
        a
    } else {
        fib_iter(n - 1, b, a + b)
    }
}

fn count_digits(n: int): int {
    if n == 0 {
        1
    } else {
        var count = 0;
        var x = n;
        while x != 0 {
            count += 1;
            x /= 10;
        }
        count
    }
}

fn is_palindrome_number(n: int): bool {
    if n < 0 {
        false
    } else {
        var original = n;
        var reversed = 0;
        var x = n;
        while x != 0 {
            reversed = reversed * 10 + (x % 10);
            x /= 10;
        }
        original == reversed
    }
}

@test
fn test_power_of_two() {
    assert(is_power_of_two(16), "16 is a power of 2");
}

@test
fn test_power_of_two_false() {
    assert(!is_power_of_two(15), "15 is not a power of 2");
}

@test
fn test_perfect_square() {
    assert(is_perfect_square(25), "25 is a perfect square");
}

@test
fn test_perfect_square_false() {
    assert(!is_perfect_square(24), "24 is not a perfect square");
}

@test
fn test_fib_iter() {
    var result = fib_iter(6, 0, 1);
    assert(result == 8, "iterative fibonacci should work");
}

@test
fn test_count_digits() {
    var result = count_digits(12345);
    assert(result == 5, "count_digits should return 5");
}

@test
fn test_complex_loop_sum() {
    var sum = 0;
    var i = 0;
    while i < 10 {
        if i % 2 == 0 {
            sum += i;
        }
        i += 1;
    }
    assert(sum == 20, "sum of even numbers 0-10 should be 20");
}

@test
fn test_nested_loops() {
    var count = 0;
    var i = 0;
    while i < 3 {
        var j = 0;
        while j < 3 {
            count += 1;
            j += 1;
        }
        i += 1;
    }
    assert(count == 9, "nested loops should count to 9");
}

@test
fn test_palindrome() {
    assert(is_palindrome_number(121), "121 is a palindrome");
}

@test
fn test_palindrome_false() {
    assert(!is_palindrome_number(123), "123 is not a palindrome");
}
